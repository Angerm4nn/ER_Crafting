@page "/gear"
@inject NavigationManager NavigationManager
@inject GearPlanner GearPlanner

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Gear Loadout</h2>
        <button class="btn btn-danger" @onclick="ClearAll">Clear All</button>
    </div>

    <div class="row">
        <!-- Left Column: Weapons and Consumables -->
        <div class="col-md-2">
            <div class="card mb-3">
                <div class="card-header bg-danger text-white">
                    <h6 class="mb-0">Weapons</h6>
                </div>
                <div class="card-body p-2">
                    <div class="mb-2">
                        <GearSlot SlotName="First Weapon"
                                  Item="@GearPlanner.FirstWeapon"
                                  FilterType="Weapon"
                                  OnClick="@(() => NavigateToFinalItems("Weapon"))"
                                  OnRemove="@(() => RemoveItem("FirstWeapon"))" />
                    </div>
                    <div class="mb-2">
                        <GearSlot SlotName="Second Weapon"
                                  Item="@GearPlanner.SecondWeapon"
                                  FilterType="Weapon"
                                  OnClick="@(() => NavigateToFinalItems("Weapon"))"
                                  OnRemove="@(() => RemoveItem("SecondWeapon"))" />
                    </div>
                    <div>
                        <GearSlot SlotName="Third Weapon"
                                  Item="@GearPlanner.ThirdWeapon"
                                  FilterType="Weapon"
                                  OnClick="@(() => NavigateToFinalItems("Weapon"))"
                                  OnRemove="@(() => RemoveItem("ThirdWeapon"))" />
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">Medication</h6>
                </div>
                <div class="card-body p-2">
                    <div class="mb-2">
                        <GearSlot SlotName="First Medication"
                                  Item="@GearPlanner.FirstMedication"
                                  FilterType="Medication"
                                  OnClick="@(() => NavigateToFinalItems("Medication"))"
                                  OnRemove="@(() => RemoveItem("FirstMedication"))" />
                    </div>
                    <div>
                        <GearSlot SlotName="Second Medication"
                                  Item="@GearPlanner.SecondMedication"
                                  FilterType="Medication"
                                  OnClick="@(() => NavigateToFinalItems("Medication"))"
                                  OnRemove="@(() => RemoveItem("SecondMedication"))" />
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">Boosters</h6>
                </div>
                <div class="card-body p-2">
                    <div class="mb-2">
                        <GearSlot SlotName="First Booster"
                                  Item="@GearPlanner.FirstBooster"
                                  FilterType="Food"
                                  OnClick="@(() => NavigateToFinalItems("Booster"))"
                                  OnRemove="@(() => RemoveItem("FirstBooster"))" />
                    </div>
                    <div>
                        <GearSlot SlotName="Second Booster"
                                  Item="@GearPlanner.SecondBooster"
                                  FilterType="Food"
                                  OnClick="@(() => NavigateToFinalItems("Booster"))"
                                  OnRemove="@(() => RemoveItem("SecondBooster"))" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Section: Character Paperdoll -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">Armor & Implants</h6>
                </div>
                <div class="card-body p-3">
                    <!-- Row 1: Helmet and Eyes Implant -->
                    <div class="row mb-3 justify-content-center">
                        <div class="col-auto">
                            <GearSlot SlotName="Helmet"
                                      Item="@GearPlanner.Helmet"
                                      FilterType="Armor"
                                      OnClick="@(() => NavigateToFinalItems("Armor/Helmet"))"
                                      OnRemove="@(() => RemoveItem("Helmet"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Eyes Implant"
                                      Item="@GearPlanner.EyesImplant"
                                      FilterType="Implant"
                                      OnClick="@(() => NavigateToFinalItems("Implant/EyesImplant"))"
                                      OnRemove="@(() => RemoveItem("EyesImplant"))" />
                        </div>
                    </div>

                    <!-- Row 2: Shoulders, Torso, and Back -->
                    <div class="row mb-3 justify-content-center">
                        <div class="col-auto">
                            <GearSlot SlotName="Shoulder Pads"
                                      Item="@GearPlanner.ShoulderPads"
                                      FilterType="Armor"
                                      OnClick="@(() => NavigateToFinalItems("Armor/ShoulderPads"))"
                                      OnRemove="@(() => RemoveItem("ShoulderPads"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Shoulder Implant"
                                      Item="@GearPlanner.ShoulderImplant"
                                      FilterType="Implant"
                                      OnClick="@(() => NavigateToFinalItems("Implant/ShoulderImplant"))"
                                      OnRemove="@(() => RemoveItem("ShoulderImplant"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Torso Armor"
                                      Item="@GearPlanner.TorsoArmor"
                                      FilterType="Armor"
                                      OnClick="@(() => NavigateToFinalItems("Armor/TorsoArmor"))"
                                      OnRemove="@(() => RemoveItem("TorsoArmor"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Torso Implant"
                                      Item="@GearPlanner.ChestImplant"
                                      FilterType="Implant"
                                      OnClick="@(() => NavigateToFinalItems("Implant/ChestImplant"))"
                                      OnRemove="@(() => RemoveItem("ChestImplant"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Back Implant"
                                      Item="@GearPlanner.BackImplant"
                                      FilterType="Implant"
                                      OnClick="@(() => NavigateToFinalItems("Implant/BackImplant"))"
                                      OnRemove="@(() => RemoveItem("BackImplant"))" />
                        </div>
                    </div>

                    <!-- Row 3: Arms -->
                    <div class="row mb-3 justify-content-center">
                        <div class="col-auto">
                            <GearSlot SlotName="Arm Pads"
                                      Item="@GearPlanner.ArmPads"
                                      FilterType="Armor"
                                      OnClick="@(() => NavigateToFinalItems("Armor/ArmPads"))"
                                      OnRemove="@(() => RemoveItem("ArmPads"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Gloves"
                                      Item="@GearPlanner.Gloves"
                                      FilterType="Armor"
                                      OnClick="@(() => NavigateToFinalItems("Armor/Gloves"))"
                                      OnRemove="@(() => RemoveItem("Gloves"))" />
                        </div>
                    </div>

                    <!-- Row 4: Legs -->
                    <div class="row justify-content-center">
                        <div class="col-auto">
                            <GearSlot SlotName="Leg Pads"
                                      Item="@GearPlanner.LegPads"
                                      FilterType="Armor"
                                      OnClick="@(() => NavigateToFinalItems("Armor/LegPads"))"
                                      OnRemove="@(() => RemoveItem("LegPads"))" />
                        </div>
                        <div class="col-auto">
                            <GearSlot SlotName="Leg Implant"
                                      Item="@GearPlanner.LegImplant"
                                      FilterType="Implant"
                                      OnClick="@(() => NavigateToFinalItems("Implant/LegImplant"))"
                                      OnRemove="@(() => RemoveItem("LegImplant"))" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Stats -->
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">Main Stats</h6>
                </div>
                <div class="card-body p-2">
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Agility</small>
                                <div class="fw-bold">@GearPlanner.Agility.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Addiction</small>
                                <div class="fw-bold">@GearPlanner.Addiction.ToString("F1")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">Regeneration</h6>
                </div>
                <div class="card-body p-2">
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Health Regen</small>
                                <div class="fw-bold">@GearPlanner.HealthRegeneration.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Stamina Regen</small>
                                <div class="fw-bold">@GearPlanner.StaminaRegeneration.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Bio Regen</small>
                                <div class="fw-bold">@GearPlanner.BioRegeneration.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Aura Regen</small>
                                <div class="fw-bold">@GearPlanner.AuraRegeneration.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Addiction Treat</small>
                                <div class="fw-bold">@GearPlanner.AddictionTreatment.ToString("F1")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header bg-danger text-white">
                    <h6 class="mb-0">Damage Stats</h6>
                </div>
                <div class="card-body p-2">
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Health Drain</small>
                                <div class="fw-bold">@GearPlanner.HealthDrain.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Stamina Drain</small>
                                <div class="fw-bold">@GearPlanner.StaminaDrain.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Bio Drain</small>
                                <div class="fw-bold">@GearPlanner.BioEnergyDrain.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Aura Loss</small>
                                <div class="fw-bold">@GearPlanner.AuraLoss.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Crit Rating</small>
                                <div class="fw-bold">@GearPlanner.CriticalOffenseRating.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Recoil</small>
                                <div class="fw-bold">@GearPlanner.WeaponRecoil.ToString("F1")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">Protection</h6>
                </div>
                <div class="card-body p-2">
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Armor</small>
                                <div class="fw-bold">@GearPlanner.ArmorValue.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Shielding</small>
                                <div class="fw-bold">@GearPlanner.Shielding.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Endurance</small>
                                <div class="fw-bold">@GearPlanner.Endurance.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Resistance</small>
                                <div class="fw-bold">@GearPlanner.Resistance.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Reflection</small>
                                <div class="fw-bold">@GearPlanner.Reflection.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Defense Rating</small>
                                <div class="fw-bold">@GearPlanner.DefenseRating.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Block Rating</small>
                                <div class="fw-bold">@GearPlanner.BlockRating.ToString("F1")</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <small class="text-muted">Prot. Reduction</small>
                                <div class="fw-bold">@GearPlanner.ProtectionReduction.ToString("F1")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stat-item {
        background-color: #f8f9fa;
        padding: 0.4rem;
        border-radius: 4px;
        text-align: center;
    }

        .stat-item small {
            display: block;
            font-size: 0.7rem;
        }

        .stat-item .fw-bold {
            font-size: 0.9rem;
        }
</style>

@code {
    protected override void OnInitialized()
    {
        GearPlanner.OnGearChanged += StateHasChanged;
    }

    private void NavigateToFinalItems(string filterType)
    {
        NavigationManager.NavigateTo($"finalitems?filter={filterType}");
    }

    private void RemoveItem(string slotName)
    {
        GearPlanner.UnequipSlot(slotName);
    }

    private void ClearAll()
    {
        GearPlanner.ClearAll();
    }

    public void Dispose()
    {
        GearPlanner.OnGearChanged -= StateHasChanged;
    }
}
